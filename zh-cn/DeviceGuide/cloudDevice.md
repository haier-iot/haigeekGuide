### 概述  

> 智能硬件以云对云方式接入海尔IoT平台，即开发者自有智能云与海尔IoT平台对接，其智能硬件连接自有智能云后，也间接实现了与海尔IoT平台的接入。    

![云设备架构][Architecture]

**该方式适用于符合以下条件的开发者（第三方厂商）：**  
拟接入IOT平台的智能硬件为IP联网硬件，即Wi-Fi类硬件、2-4G类硬件、网关+子设备类硬件（如Zigbee设备）等；  
拥有自己的云（服务器），且云的稳定性和可靠性较好，拟接入IOT平台的自有智能硬件连接到自己的云；

![云设备接入方案][Access_plan]

### 创建功能集  

1、 在[海极网][Haigeek]注册企业账号并审核通过后，进入【产品中心】导航栏进行新的产品创建，点击【按功能集创建】按钮。  

![云设备创建功能集][Create_function]

2、 在弹出的对话框里，【功能集名称】、【设备类型】填写完整后，【接入方式】选择【云设备】，点击【确定】按钮。  

![云设备创建功能集][Create_function2]

###  定义功能集  

> 对于各品类的产品，平台已制定了标准的产品功能定义即功能集又称功能模板；且对于标准的功能定义，小优音箱也在语义层面支持语音控制。
产品功能定义，描述了产品具有哪些功能，包括基础功能、高级功能、告警、其他功能。 本文截图以创建智能灯具为例。  


概念|解释
:-|:-
基础功能|单一的功能操作即属性，属性支持被查询、控制和订阅，如灯的开关
高级功能|主要用于向设备下发组合控制指令，该功能即可以定义为方法，方法可支持同时下发多个属性（参数），如电灯的模式及亮度
告警|主要用于设备向云端上报组合数据，可支持同时上报多个属性（参数），如洗衣完成
其他功能|主要用于设备向云端上报组合数据，可支持同时上报多个属性（参数），服务大数据 

<font color="#FF0000">注：高级功能，平台默认需要实现的组命令：getAllProperty(查询所有属性)、getAllAlarm(查询报警)、stopCurrentAlarm(停止报警)</font>

#### 功能集添加 

通过“创建功能集”点击【确定】按钮后会弹出“产品选择功能”对话框页面，选择相应的功能模板，选择产品要实现的功能，点击【添加选中功能】按钮。  


![云设备功能集定义][Function_set]


#### 功能集配置  


通过【添加选中功能】进入“功能集配置”页面，可按照标准或自定义配置产品的功能。

平台会根据产品的类型默认配置好标准功能（可点击图中【标准服务】按钮查看）。默认配置的标准功能包括必选和非必选，开发者可通过【自定义功能】来自定义增添新的功能，高级功能信息项不支持自定义，开发者也可对部分功能并进行编辑。   

<font color="#FF0000">注：自定义功能不支持接入高级服务（如U+APP、场景……）如需要新增或修改标准功能，请联系标准团队进行功能标准化(wangxianqing.uh@haier.com)</font>  

在产品最终上线前，功能定义的状态会保持“开发中”，该状态下可随时调整功能定义。一旦产品开始提交上线申请或已上线，状态会随之改变为“审核中”或“已上线”，之后功能定义不可再修改。

![基础功能][Basis_function]  

![高级功能][Advanced_function]

![其他功能][Other_function]


**基础功能信息项说明：**  
支持自定义功能  

信息项|说明|备注
:-|:-:|:-
序号|即所选功能的顺序号，通讯协议按此序号生成|无
显示名称|属性的说明|无
标识名称|即属性名称|添加自定义功能时，建议格式为"第三方标识字母_"，例如，“haier_”
读写类型|包括：读、写、单可写、组可写|无
数据类型|包括：整型、布尔、字符串、浮点型、时间、枚举等|无
属性位置|表示某个已定义的属性在字节中的位置|无
取值描述|属性的数据类型描述|无
指令|E++协议负载指令|无
操作|包括：修改、重置(更新)、删除、上移、下移|可修改取值描述



**高级功能信息项说明：**  
不支持自定义功能  

信息项|说明|备注
:-|:-:|:-
序号|即所选功能的顺序号，通讯协议按此序号生成|无
命令名称|组命令操作名称|无
指令|E++协议负载指令|无
输入参数/属性位置|表示某个已定义的属性在组命令中的字节位置|无
操作|包括：修改、删除|默认实现的组命令不可操作


**告警功能信息项说明：**  
支持自定义功能，主要用于设备向云端上报。  

信息项|说明|备注
:-|:-:|:-
序号|即所选功能的顺序号，通讯协议按此序号生成|无
显示名称|组命令操作名称|无
标识名称|即属性名称|添加自定义功能时，建议格式为"第三方标识字母_"，例如，“haier_”
数据类型|包括：整型、布尔、字符串、浮点型、时间、枚举等|无
操作|包括：修改、重置(更新)、删除、上移、下移|可修改取值描述 


**其他功能信息项说明：**  
支持自定义功能 ，主要用于设备向云端上报。 

信息项|说明|备注
:-|:-:|:-
序号|即所选功能的顺序号，通讯协议按此序号生成|无
显示名称|属性的说明|无
标识名称|即属性名称|添加自定义功能时，建议格式为"第三方标识字母\_"，例如，“haier\_”
读写类型|包括：读、写、单可写、组可写|无
数据类型|包括：整型、布尔、字符串、浮点型、时间、枚举等|无
大数据属性位置|表示某个已定义的属性在字节中的位置|无
取值描述|属性的数据类型描述|无
操作|包括：修改、重置(更新)、删除、上移、下移|可修改取值描述


### <span id="jump1">设备开发/配置参数</span>  

通过“功能集配置”页面配置好产品的功能后，点击【保存】按钮，进入“设备开发”页面。  


设备开发”页面主要包括三个信息项，即“开发流程”、“参数配置”、“业务功能”。  

**开发流程：**  

平台提供程序开发需要的开发文档，程序调试工具，在线测试工具。

**参数配置：**   

平台会自动分配各开发环境需要的SystemID、SystemKey，校验云设备的凭证；  
查询设备信息回调URL，由第三方开发者填写，平台通过本URL来主动向第三方云服务定期同步设备信息；  
读设备属性回调URL，由第三方开发者填写，平台回调本URL通过第三方云服务发送给设备执行，读取设备属性；  
写设备属性回调URL，由第三方开发者填写，平台回调本URL通过第三方云服务发送给设备执行，写设备属性即单命令操作；  
设备操作回调URL，由第三方开发者填写，平台回调本URL通过第三方云服务发送给设备执行，操作设备即组命令操作；
填写好回调URL后，点击【保存】按钮。  

**业务功能：**     

指所选功能间的业务逻辑关系，例如照明灯具只能在开启状态的前提下才能控制灯光亮度。 

 

![开发流程][Development_process]

![参数配置][Parameter_configuration]


### 创建产品  

创建产品即创建产品型号。  

![产品型号][Product_model]  

点击上图【创建型号】按钮，在弹出的对话框里填写产品型号相关信息，下拉滚动条点击【确定】按钮。   


![创建型号][Create_model] 

点击上图【确定】按钮后，进入产品型号详情界面，开发者可以对相关功能进行编辑操作。

**逻辑约束规则：**  

指所选功能间的业务逻辑关系，例如照明灯具只能在开启状态的前提下才能控制灯光亮度。 

**补丁命令规则：**    

  
  
   

![产品型号完成][Create_success] 

点击上图【保存】按钮，产品型号创建完成。

![产品型号][Create_model]   

操作功能：  

操作项|说明
:-|:-
编辑|编辑型号信息，包括名称、品牌、产品描述等
复制|从当前型号，复制功能到另外一个型号
删除|删除已添加的型号
下载|下载型号对应的设备功能模型文档


### 接入优家

型号创建完成后，在接入U+ APP流程中，确定产品是优家官方UI接入还是自助开发UI接入。  

官方UI提供通用的控制功能，如果要接入U+ APP的产品功能，包含在官方UI模板中则可以按U+官方UI免开发接入；如果在官方UI模板中没有找到，请选择自助开发UI模式。 例如选择“官方设备详情页”(即优家官方UI)后，点击【使用选中UI】按钮。   


![接入优家][AccessU+]   


点击【使用选中UI】按钮后，进入“APP配置”页面。

![优家配置][App_config] 

#### 配网引导配置
点击“配网引导”下的【点击配置】按钮。    

1、选择配置方式；  
2、上传配网引导第一步及后续步骤的图片(图片宽高必须是4:3);  
3、上传已进入配网状态图片(图片宽高必须是3:1)。  


![点击配置][Click_config] 

#### APP界面配置  
  
点击“界面配置”下方的【查看配置】按钮。  

**官方设备详情页：**  

当UI使用官方设备详情页时，点击【查看配置】按钮，会显示U+ APP兼容的功能列表。

![优家详情界面][U+_ui]   

**官方设备详情页：**  

当UI使用自定义设备详情页时，点击【查看配置】按钮，会提示请联系优家APP（jiachunhui@haier.com），上传资源包，接入优家APP。

#### 场景功能配置   
 
点击“场景配网”下的【点击配置】按钮，选择设备场景功能，默认选择功能为场景模板中用到的功能，支持启动场景模板；如果取消默认选中的功能，可能会导致场景模板不能被启用。  

![场景功能][Scene_function]   


### 拓展功能配置  

**故障自反馈:**  

为开发者提供配置设备故障及故障推送的逻辑，开发者可以把创建的告警信息，配置为故障通知事件，并在此定义故障描述、推送逻辑、售后提示信息、用户提醒信息等。  

**微信公众号：**  

为智能硬件开发者提供免开发的微信公众号解决方案，开发者可以快速实现微信控制智能硬件的功能，节省开发移动应用的成本，实现产品快速上市。  

**设备升级：**  

为智能设备提供远程在线升级服务，包括固件管理、升级任务管理和升级日志等功能。应用场景包括提升设备能力、硬件安全策略升级、设备缺陷修复、设备连接能力迭代等。  

![拓展功能][Expand_functionality] 

### 适配平台协议   

 **1、协议开发：**  

开发者在自有云中，需要完成U+ IOT协议和开发者硬件自有协议之间的转换适配，进而实现控制指令由开发者自有智能云下发给设备后可以正确执行。

开发者在自有智能云上需要实现的与平台对接的接口请详见[《接口使用文档》][Dev_world]。


**2、协议调试：**

平台提供了设备的在线测试工具，方便开发者在接入过程中进行调试使用。见[设备开发/配置参数](#jump1)步骤`开发流程`小节。  

本在线测试工具，主要用于协助验证协议适配是否准确、可用。进入某设备的调试页面后，会看到该设备可以支持调试的单命令、高级命令(即组命令)，其与该产品在平台配置的功能定义（参见《U+开放平台XXX设备功能模型》,[设备开发/配置参数](#jump1)步骤`开发流程`小节`程序开发-开发文档`,即设备模型文档）一致。

选择相应的功能，点击其【发送命令】操作，日志里即可得到该功能的调试结果。  


<font color="#FF0000">注：请在成功配置设备入网20分钟内点击启动按钮，开始在线测试</font>  

![在线测试工具][Testing_tools] 

### 上线产品     

产品在开发与自测完成后，即可安排上线。产品提交申请后产品相关配置即禁止修改。    

点击【申请上线】按钮，上传测试报告，测试报告根据平台提供的测试模板填写，填写设备标识码，点击【提交审核】按钮，到此完成产品上线申请。    

![申请上线][Online_apply] 
![提交审核][Submit_audit] 





[Access_plan]:_media/Link/guide.png  
[Architecture]:_media/Link/architecture.png 
[Create_function]:_media/Link/create_function.png  
[Create_function2]:_media/Link/create_function2.png  
[Function_set]:_media/Link/function_set.png  
[Haigeek]:https://www.haigeek.com/web/pages/haigeek.html
[Basis_function]:_media/Link/basis_function.png 
[Advanced_function]:_media/Link/advanced_function.png 
[Other_function]:_media/Link/other_function.png
[Development_process]:_media/Link/development_process.png
[Parameter_configuration]:_media/Link/parameter_configuration.png  
[Product_model]:_media/Link/product_model.png 
[Create_model]:_media/Link/create_model.png  
[Create_success]:_media/Link/create_success.png 
[Create_model]:_media/Link/model_success.png  
[AccessU+]:_media/Link/accessU+.png 
[App_config]:_media/Link/app_config.png  
[Click_config]:_media/Link/click_config.png   
[U+_ui]:_media/Link/u+_ui.png    
[Scene_function]:_media/Link/scene_function.png 
[Expand_functionality]:_media/Link/expand_functionality.png
[Dev_world]:https://haier-iot.github.io/guide/#/zh-cn/Cloudgw  
[Testing_tools]:_media/Link/testing_tools.png 
[Online_apply]:_media/Link/online_apply.png 
[Submit_audit]:_media/Link/submit_audit.png 